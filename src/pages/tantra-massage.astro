---
import Base from '../layouts/Base.astro';
import ListingCard from '../components/ListingCard.astro';
import CategoryNav from '../components/CategoryNav.astro';
import InternalLinks from '../components/InternalLinks.astro';
import OwnerCTA from '../components/OwnerCTA.astro';
import NetworkLinks from '../components/NetworkLinks.astro';

// Safe fetch helper for fake category pages
async function safeFetch(url: string): Promise<any[]> {
    try {
        console.log('[fakeCat] Fetching:', url);
        const res = await fetch(url, { 
            headers: { 
                'Accept': 'application/json',
                'User-Agent': 'ErotikMaps-Satellite-Builder/1.0',
                'X-Satellite-Build': 'true'
            } 
        });
        if (!res.ok) return [];
        const ct = res.headers.get('content-type') || '';
        if (!ct.includes('application/json')) return [];
        const data = await res.json();
        return data.data || [];
    } catch (e) {
        console.error('[fakeCat] Fetch failed:', e);
        return [];
    }
}

// Fetch listings for this specific fake category
const apiUrl = 'https://www.erotikmaps.com/api/v1/satellite/listings?city=moscow&category=tantra-massage&limit=50';
let listings = await safeFetch(apiUrl);

// If no specific listings, fallback to main erotic-massage listings
if (listings.length === 0) {
    const fallbackUrl = 'https://www.erotikmaps.com/api/v1/satellite/listings?city=moscow&category=erotic-massage&limit=30';
    listings = await safeFetch(fallbackUrl);
}

const canonicalUrl = 'https://eroticmassagemoscow.net/tantra-massage';
---

<Base 
    title="‚òØÔ∏è Tantra Massage in Moscow | Best Tantra Massage Venues 2026"
    description="Discover the finest Tantra Massage venues in Moscow, Russia. Browse verified listings with photos, reviews & contact info. Find Tantra Massage near you!"
    canonical={canonicalUrl}
    image={listings.length > 0 && listings[0].thumbnail ? listings[0].thumbnail : 'https://erotikmaps.com/images/og-default.jpg'}
>
    <!-- Hero Section -->
    <section class="hero category-hero">
        <div class="container">
            <span class="hero-icon">‚òØÔ∏è</span>
            <h1>Tantra Massage in Moscow</h1>
            <p class="hero-subtitle">
                {listings.length > 0 
                    ? `Discover ${listings.length} verified Tantra Massage venues in Moscow` 
                    : `Explore Tantra Massage experiences in Moscow`
                }
            </p>
        </div>
    </section>
    
    <!-- Category Navigation - Internal Links to other massage types -->
    <CategoryNav city="Moscow" currentCategory="tantra-massage" />
    
    <!-- Intro Content -->
    <section class="intro">
        <div class="container">
            <h2>About Tantra Massage in Moscow</h2>
            <p>
                Looking for authentic <strong>Tantra Massage</strong> experiences in Moscow? 
                Our curated directory features the best Tantra Massage venues in the Moscow area. 
                Whether you're a local or visiting Russia, we help you discover quality 
                Tantra Massage services with verified listings, photos, and direct contact information.
            </p>
            <p>
                Tantra Massage is known for its unique techniques and relaxing atmosphere. 
                In Moscow, you'll find a variety of establishments offering authentic 
                Tantra Massage experiences, from traditional venues to modern wellness centers.
            </p>
        </div>
    </section>
    
    <!-- Listings Grid -->
    <section class="listings" id="listings">
        <div class="container">
            <h2>Tantra Massage Venues in Moscow</h2>
            {listings.length > 0 ? (
                <div class="listings-grid">
                    {listings.map((listing: any) => (
                        <ListingCard listing={listing} />
                    ))}
                </div>
            ) : (
                <div class="no-listings">
                    <p>No specific Tantra Massage venues found in Moscow yet.</p>
                    <p>
                        <a href="/" class="btn-primary">Browse All Erotic Massage Venues ‚Üí</a>
                    </p>
                    <p class="cta-text">
                        Own a Tantra Massage venue in Moscow? 
                        <a href="https://gopremium.app/create-listing" rel="nofollow" title="Add your venue">
                            List it for FREE
                        </a>!
                    </p>
                </div>
            )}
        </div>
    </section>
    
    <!-- Related Categories - Smart Internal Links -->
    <section class="related-cats">
        <div class="container">
            <h2>Explore Other Massage Types in Moscow</h2>
            <div class="related-grid">
                <a href="/" class="related-link main">üè† All Erotic Massage</a>
                <a href="/nuru-massage" class="related-link">üíÜ Nuru Massage</a>
                <a href="/tantric-massage" class="related-link">üïâÔ∏è Tantric Massage</a>
                <a href="/body-to-body-massage" class="related-link">‚ú® Body to Body</a>
                <a href="/sensual-massage" class="related-link">üíï Sensual Massage</a>
                <a href="/happy-ending-massage" class="related-link">üòä Happy Ending</a>
                <a href="/adult-massage" class="related-link">üîû Adult Massage</a>
            </div>
            <p class="more-link">
                Discover more <a href="https://erotikmaps.com/tantra-massage" title="Tantra Massage worldwide">Tantra Massage venues worldwide</a> on ErotikMaps
            </p>
        </div>
    </section>
    
    <!-- Network Links - Links to other satellite sites -->
    <NetworkLinks currentCity="Moscow" currentCountry="Russia" category="erotic-massage" />
    
    <!-- Internal Links -->
    <InternalLinks city="Moscow" country="Russia" category="Tantra Massage" />
    
    <!-- Owner CTA -->
    <OwnerCTA city="Moscow" country="Russia" category="Tantra Massage" />
    
    <!-- Schema.org -->
    <script type="application/ld+json" set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "CollectionPage",
        "name": "Tantra Massage in Moscow",
        "description": "Directory of Tantra Massage venues in Moscow, Russia",
        "url": canonicalUrl,
        "isPartOf": {
            "@type": "WebSite",
            "name": "Moscow Erotic massage",
            "url": "https://eroticmassagemoscow.net"
        },
        "breadcrumb": {
            "@type": "BreadcrumbList",
            "itemListElement": [
                { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://eroticmassagemoscow.net" },
                { "@type": "ListItem", "position": 2, "name": "Tantra Massage", "item": canonicalUrl }
            ]
        }
    })}></script>
</Base>

<style>
    .category-hero {
        text-align: center;
    }
    .hero-icon {
        font-size: 4rem;
        display: block;
        margin-bottom: 15px;
    }
    .no-listings {
        text-align: center;
        padding: 50px 20px;
        background: var(--card-bg);
        border-radius: 12px;
    }
    .no-listings p {
        margin-bottom: 15px;
    }
    .cta-text {
        font-size: 14px;
        color: var(--text-light);
    }
    .related-cats {
        padding: 50px 0;
        background: var(--card-bg);
    }
    .related-cats h2 {
        text-align: center;
        margin-bottom: 25px;
    }
    .related-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        justify-content: center;
        margin-bottom: 25px;
    }
    .related-link {
        padding: 12px 20px;
        background: var(--bg);
        border-radius: 8px;
        font-size: 14px;
        color: var(--text);
        transition: all 0.2s;
    }
    .related-link:hover {
        background: var(--primary);
        color: white;
    }
    .related-link.main {
        background: var(--primary);
        color: white;
    }
    .more-link {
        text-align: center;
        font-size: 14px;
        color: var(--text-light);
    }
    .more-link a {
        color: var(--primary);
    }
</style>